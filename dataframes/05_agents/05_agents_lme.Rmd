---
title: "05_agents_lme"
output: html_notebook
---

```{r}
# Install packages
library(brms)
library(lme4)
library(tidyverse)
library(performance)
library(ggfortify)

# Set variables
subjects = list("FUYU", "OTTER", "ADAPTER", "GPT-4V", "CLAUDE-3", "HUMAN")
experiments = list("intention", "counterfactual")
setwd("~/Documents/Projects/multimodal/dataframes/05_agents")

# Pre-allocate output array
out_intention <- matrix(data=NA,nrow=length(subjects),ncol=3)
out_counterfactual <- matrix(data=NA,nrow=length(subjects),ncol=3)
```

```{r}
for (ind in seq_along(subjects)) {
  
  # Load data for each individual model
  print(str_glue("{subjects[[ind]]}"))
  temp <- read.csv(str_glue("{subjects[[ind]]}_intention.csv"))
  
  # Only compute model if there is more than 1 non NA response
  if (sum(!is.na(unique(temp$Model))) > 1) {
    
    # Z-Scale individual humans
    temp <- temp %>%
      group_by(Ind) %>%
      mutate(Human_z = scale(Human)[,1]) %>%
      ungroup()
  
    # Regression with random slope but no intercept (fixed at 0)
    temp.lm <- brm(scale(Model)~-1+Human_z+(-1+Human_z|Ind), data=temp, iter=4000, control = list(adapt_delta = 0.95))
    print(summary(temp.lm))
    
    # Save to output
    out_intention[ind, 1] = fixef(temp.lm)[1]
    out_intention[ind, 2] = fixef(temp.lm)[3]
    out_intention[ind, 3] = fixef(temp.lm)[4]
  }
}

# Write
write.table(out_intention, file="05_intention_lmer.csv", sep = ",", row.names = TRUE, col.names = TRUE)
```
```{r}
for (ind in seq_along(subjects)) {
  
  # Load data for each individual model
  print(str_glue("{subjects[[ind]]}"))
  temp <- read.csv(str_glue("{subjects[[ind]]}_counterfactual.csv"))
  
  # Only compute model if there is more than 1 non NA response
  if (sum(!is.na(unique(temp$Model))) > 1) {
    
    # Z-Scale individual humans
    temp <- temp %>%
      group_by(Ind) %>%
      mutate(Human_z = scale(Human)[,1]) %>%
      ungroup()
  
    # Regression with random slope but no intercept (fixed at 0)
    temp.lm <- brm(scale(Model)~-1+Human_z+(-1+Human_z|Ind), data=temp, iter=4000, control = list(adapt_delta = 0.95))
    print(summary(temp.lm))
    
    # Save to output
    out_counterfactual[ind, 1] = fixef(temp.lm)[1]
    out_counterfactual[ind, 2] = fixef(temp.lm)[3]
    out_counterfactual[ind, 3] = fixef(temp.lm)[4]
  }
}

# Write
write.table(out_counterfactual, file="05_counterfactual_lmer.csv", sep = ",", row.names = TRUE, col.names = TRUE)
```